<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Kontrol Anak</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #121212; color: white; text-align: center; font-family: sans-serif; padding: 20px; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; }
        button { 
            width: 100%; padding: 15px; margin: 10px 0; border-radius: 10px; border: none; 
            font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s;
        }
        .btn-connect { background: #3498db; color: white; }
        .btn-on { background: #2ecc71; color: white; }
        .btn-off { background: #e74c3c; color: white; }
        .btn-check { background: #f1c40f; color: black; }
        #status { font-weight: bold; padding: 10px; border-radius: 5px; margin-bottom: 20px; }
        .online { background: #2ecc71; color: black; }
        .offline { background: #e74c3c; color: white; }
        img { max-width: 100%; border-radius: 10px; margin-top: 10px; }
    </style>
</head>
<body>

    <h2>üéÆ DASHBOARD REMOTE</h2>
    <div id="status" class="offline">STATUS: TERPUTUS</div>

    <div class="card">
        <button class="btn-connect" onclick="hubungkan()">1. HUBUNGKAN KE HP ANAK</button>
    </div>

    <div class="card">
        <h3>üî¶ KONTROL HARDWARE</h3>
        <button class="btn-on" onclick="kirim('SENTER_ON')">NYALAKAN SENTER</button>
        <button class="btn-off" onclick="kirim('SENTER_OFF')">MATIKAN SENTER</button>
    </div>

    <div class="card">
        <h3>üì∏ MONITORING</h3>
        <button class="btn-check" onclick="kirim('CEK_FOTO')">AMBIL FOTO DEPAN</button>
        <button class="btn-check" onclick="kirim('CEK_LOKASI')">CEK LOKASI GPS</button>
    </div>

    <div id="hasil" class="card" style="display:none;">
        <div id="konten-hasil"></div>
    </div>

    <script>
        const KUNCI = "hayabusa_monitor_anak"; // Harus sama dengan index.html
        let peer = new Peer();
        let conn;

        function hubungkan() {
            document.getElementById('status').innerText = "MENCOBA MENGHUBUNGKAN...";
            
            // Mencoba koneksi ke HP Anak
            conn = peer.connect(KUNCI);

            conn.on('open', () => {
                document.getElementById('status').innerText = "STATUS: TERHUBUNG ‚úÖ";
                document.getElementById('status').className = "online";
                alert("Koneksi Berhasil!");
            });

            // Menerima data kiriman dari HP Anak (Foto/Lokasi)
            conn.on('data', (data) => {
                document.getElementById('hasil').style.display = "block";
                if(data.type === "FOTO") {
                    document.getElementById('konten-hasil').innerHTML = `<h4>Foto Terkini:</h4><img src="${data.data}">`;
                }
                if(data.type === "LOKASI") {
                    const link = `https://www.google.com/maps?q=${data.lat},${data.lon}`;
                    document.getElementById('konten-hasil').innerHTML = `<h4>Lokasi Anak:</h4><a href="${link}" target="_blank" style="color:#3498db">Buka di Google Maps</a>`;
                }
            });

            conn.on('close', () => {
                document.getElementById('status').innerText = "STATUS: TERPUTUS ‚ùå";
                document.getElementById('status').className = "offline";
            });
        }

        function kirim(perintah) {
            if (conn && conn.open) {
                conn.send(perintah);
            } else {
                alert("Belum terhubung! Klik tombol 'HUBUNGKAN' dulu.");
            }
        }
    </script>
</body>
</html>
